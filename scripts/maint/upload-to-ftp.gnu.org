#!/bin/bash

set -e

file=$1

if test -z "$file"; then
  echo "usage: $0 FILE">&2; exit 1
fi

package=`echo "$file" | perl -p -e 's/-[0-9]+(\.[0-9]+)*.tar.gz//'`

gpg -b $file

cat >$file.directive <<EOF
version: 1.1
directory: guile-gnome/$package
filename: $file
comment: new version of $package
EOF
gpg --clearsign $file.directive

# e.g. ftp://anonymous@ftp-upload.gnu.org/incoming/ftp
url=$2
if test -n "$url"; then
    for i in $file.directive.asc $file.sig $file; do
        gnomevfs-copy file://`pwd`/$i $url/$i
    done
fi
